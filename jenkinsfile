node('maven') {

stage 'buildInDevelopment'
openshiftBuild(namespace: 'cicd-dev', buildConfig: 'myapp', showBuildLogs: 'true')

stage 'deployInDevelopment'
openshiftDeploy(namespace: 'cicd-dev', deploymentConfig: 'myapp')
openshiftScale(namespace: 'cicd-dev', deploymentConfig: 'myapp',replicaCount: '2')

stage 'test'
sh 'curl -s  http://myapp-cicd-dev.192.168.99.101.nip.io'

stage 'deployInTesting'
openshiftTag(namespace: 'cicd-dev', sourceStream: 'myapp',  sourceTag: 'latest', destinationNamespace: 'cicd-dev',  destinationStream: 'myapp', destinationTag: 'promoteToQA')
openshiftDeploy(namespace: 'cicd-test', deploymentConfig: 'myapp')
openshiftScale(namespace: 'cicd-test', deploymentConfig: 'myapp',replicaCount: '3')
}


