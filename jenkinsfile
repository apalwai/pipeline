node('maven') {

stage 'buildInDevelopment'
openshiftBuild(namespace: 'development', buildConfig: 'flower-app', showBuildLogs: 'true')

stage 'deployInDevelopment'
openshiftDeploy(namespace: 'development', deploymentConfig: 'flower-app')
openshiftScale(namespace: 'development', deploymentConfig: 'flower-app',replicaCount: '2')

stage('SCM') {
    git 'https://github.com/masauve/bgdemo'
  }
  stage('SonarQube analysis') {
    // requires SonarQube Scanner 2.8+
    def scannerHome = tool 'SonarQube Scanner 2.8';
    withSonarQubeEnv('scanner') {
      sh "${scannerHome}/bin/sonar-scanner"
    }
  }

stage 'deployInTesting'
openshiftTag(namespace: 'development', sourceStream: 'flower-app',  sourceTag: 'latest', destinationNamespace: 'development',  destinationStream: 'flower-app', destinationTag: 'promoteToQA')
openshiftDeploy(namespace: 'testing', deploymentConfig: 'flower-app')
openshiftScale(namespace: 'testing', deploymentConfig: 'flower-app',replicaCount: '3')
}


